!function(e,r){"function"==typeof define&&define.amd?define("anyloader",["jquery","underscore"],r):"undefined"!=typeof exports?r(require("jquery"),require("underscore")):e.LoaderFactory=r(e.jQuery||e.Zepto||e.ender||e.$,e._)}(this,function(e,r){var t="[name],[id],[data-name]",n=/[{}<>\[\]]/;return function(a){if(r.isObject(a)||(a={}),r.has(a,"create")&&!r.isFunction(a.create))throw new Error("create callback should be a function");if(r.has(a,"parse")&&!r.isFunction(a.parse))throw new Error("parse callback should be a function");var i=function(){var c=Array.prototype.slice.call(arguments,0),o=[];return r.each(c,function(c){if(null!=c){if(r.isString(c)){if(!n.test(c)){var u=e.Deferred();return e.ajax({url:c}).done(function(e,t){"success"==t?r.isObject(e)||r.isString(e)&&n.test(e)?i(e).done(function(e){u.resolve(e)}):u.reject("wrong object in "+c):u.reject("error while loading object from "+c)}).fail(function(){u.reject("error while loading object from "+c)}),void o.push(u)}try{c=e.parseJSON(c.replace(/[\n\r\t]/g,""))}catch(s){if(a.parse)c=a.parse(c);else try{c=e(c);var f=c.filter(t);f.length>0&&(c=f)}catch(s){c=null}}}if(c instanceof e){var l={},d=[];c.each(function(){var r=e(this),t=r.attr("name")||r.attr("id")||r.data("name"),n=e.trim(r.html());t?l[t]=n:d.push(n)}),c=r.isEmpty(l)?d:l}a.create&&(c=a.create(c),null==c)||o.push(c)}}),r.isEmpty(o)&&o.push(null),e.when.apply(this,o)};return i}});